// Based on https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning#.Net
using System.Security.Cryptography.X509Certificates;
using UnityEngine.Networking;

class CustomCertificateHandler : CertificateHandler
{
    // Encoded RSAPublicKey
    private const string PUB_KEY = "3082020A0282020100B6FD052921F5F4A1C24F86BE12C193FC5F4496E631EE0551DDCE3AA8C0D6" +
        "EE8F58C36B5EC0655B544B02A7D4BD1B3E58E7F1572B31FED61E134F362B4CDD0458BA7F57E467B1D18499087A2ACF9C17DC3E97AA" +
        "D741EF893479521F0255D5920195695118FC7EC3DC5427CB12D2AF3F7138F288ADC2A486B052D38C5AC28B31E5466BC29BB3FFF3517" +
        "523113A91A06583B1F0737A5B84994FD446DE7B5B4010DEEE8FF62F0097CBE6CB1FECA63ADBCC0D6A22E3D96F49FDB9B5337CAFA6EC" +
        "F79D560B99B701124D9B61B2238902BB80AD9A3AF82A9A712B588C43DCF5BC09146BB863E2BB02C8F8310C8B5C6FD64CCD4AB2B7FC71" +
        "2CB4EE14FB82A40EF56DCBEA146E2D745893AB3FABA2658E12D72E79C07F064F60AF1EBAC3B3411A7604C86147EFC9FC8B2DE80C8D98" +
        "AD5CAA17AC7BE1415877B82A97CFB56B2307DBF3F549F909AC4151771269E7B10498565281ECBF8C6AE35F9E0F4270AAB2037F9AF66FF" +
        "2D4FB0F0929860A8EC46DD63A62018B5E2648C73E9605FF9E0B7490B71C55ED8922CB318B6A452FB245DC2D68528EDEC50E84D4A9F018" +
        "408810E6517948F1DFBE5C36D426359AFEECD4B4F6F75180770702AFDFDB6AA32F36E39DCE297BA792314D54EBCBF24A062A8C199682F0A" +
        "7CA8F10C90DB1C37693778FA3E0189451143758316F23104ABF434890174254852672589E465E8E01FC12C6C332E5F43E0D0203010001";


    private const string PUB_KEY_2 = "3082010A0282010100CE693F0F86DC58135485162709D7088F7EEF9B2C14C05BA5C34E5E141479E6" +
        "C2B33EF7F17E9372933374A60A800493A569ED049FE4CF501B8151408627FB9E3B5D9F304E480E72C26FF33B2FC7B502C97A11EA7F9681" +
        "B68ACD8B478340E5F281ADEF00C7DF51CC7D2B66C7BC65C48FA99478F35903C3CCAC0D1043B8659C093BF15CF8BC20FE76539EDAD6D1B1" +
        "68262D53D960210A6DF8A5EB6CEC0289C9CBC6E0ED2FA9E7305DFE89283DA6BE42A7A2E59711B554D4DC32E26C6614D865AC472A417A78" +
        "7514A5918AFFCA6C4F1D55B12E3F008A3263CA1DCE547C83CA64F65B272C0EAA96E40AB74C57968390C2C03C8072267292E6BD73E27397" +
        "56EB6F2DC50203010001";

    private const string PUB_KEY_3 = "3082010A0282010100C2B786FA20817A363A8F6" +
        "991EB81D55E15E69627FCD574E368B43E8F12BD0000DB2973D7B4E97EFBFB1C2B7243" +
        "E7EF3A246AC3EA8486493E86A9E3A4CA370D95D638DA58E03254FCE29268CBFD04CE73" +
        "DEA032793F16D7845D47BA06DF0D2D6693E7D8CE377DE953BCC2F4BDD7B844BE96CDBD" +
        "C9967AFD848B9A6A50423D09A756282E557807C709E3060CA4DF6D990535F9CCCBAFF9EB" +
        "404B19B3FCE3060F892D954C17E7BA4E4EE58CB0C6EC4CF185BD763EE38515FA0E3B4A0F8" +
        "72D6F6F623451B96A69E901F5F68775A4475965FFF41E534FA7C6DDF335A4B97FCFF2B413C" +
        "550A502B31CEC9389766919CE1953AF69730FE5B9B5E8C5935976733BB9889F0203010001";


    protected override bool ValidateCertificate(byte[] certificateData)
    {
        X509Certificate2 certificate = new X509Certificate2(certificateData);

        string pk = certificate.GetPublicKeyString();



        return pk.Equals(PUB_KEY) || pk.Equals(PUB_KEY_2) || pk.Equals(PUB_KEY_3);
    }
}